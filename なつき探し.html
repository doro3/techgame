<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>【唯一のなつきを探せ】1000文字チャレンジ</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --success-color: #27ae60;
            --bg-color: #f0f3f5;
            --cell-size: 36px;
        }

        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            width: 100%;
            padding: 1.5rem 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .info-panel {
            background: white;
            margin: 20px;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex;
            gap: 40px;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .timer-val { color: #e67e22; min-width: 60px; }

        .btn-group {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 12px 24px;
            font-size: 1rem;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background-color: #3498db;
            color: white;
            transition: all 0.2s;
            font-weight: bold;
        }

        button:hover {
            filter: brightness(1.1);
            transform: translateY(-1px);
        }

        #giveup-btn { background-color: #95a5a6; }

        /* グリッド設計：1000文字用に最適化 */
        #grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(var(--cell-size), 1fr));
            width: 90vw;
            max-width: 1000px;
            gap: 2px;
            background-color: #bdc3c7;
            border: 3px solid #7f8c8d;
            margin-bottom: 40px;
        }

        .cell {
            aspect-ratio: 1 / 1;
            background-color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            cursor: pointer;
            user-select: none;
        }

        .cell:hover {
            background-color: #f1f2f6;
        }

        /* 見つけた時のスタイル */
        .cell.found {
            background-color: var(--success-color) !important;
            color: white;
            font-weight: bold;
            animation: success-pulse 0.5s ease;
        }

        @keyframes success-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* ギブアップ時のヒント */
        .cell.hint {
            background-color: #fff3cd !important;
            border: 2px solid #ffcc00;
        }
    </style>
</head>
<body>

<header>
    <h1>唯一の「なつき」を探せ</h1>
    <p>1,000文字の海に、彼女は一人だけいます。</p>
</header>

<div class="info-panel">
    <div>目標: <span style="color:var(--success-color)">なつき (1箇所)</span></div>
    <div>TIME: <span id="timer" class="timer-val">0.0</span>s</div>
</div>

<div class="btn-group">
    <button onclick="startGame()">盤面をリセット</button>
    <button id="giveup-btn" onclick="revealAnswer()">答えを見る</button>
</div>

<div id="grid"></div>

<script>
    const GRID_SIZE = 800;
    const TARGET = "なつき";
    const CHARS = "あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわをん";

    let targetIndex = -1;
    let startTime;
    let timerId;
    let isFinished = false;

    /**
     * ゲーム開始
     */
    function startGame() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        isFinished = false;
        clearInterval(timerId);
        
        // 1. 文字列生成と「唯一性」の確保
        const data = generateUniqueData();
        
        // 2. 描画
        const fragment = document.createDocumentFragment();
        data.forEach((char, index) => {
            const div = document.createElement('div');
            div.className = 'cell';
            div.innerText = char;
            div.dataset.index = index;
            div.onclick = () => checkAnswer(index);
            fragment.appendChild(div);
        });
        grid.appendChild(fragment);

        // 3. タイマー開始
        startTime = Date.now();
        timerId = setInterval(updateTimer, 100);
    }

    /**
     * 重複を絶対に許さないデータ生成ロジック
     */
    function generateUniqueData() {
        let arr = [];
        
        // A. まずランダムに埋める
        for (let i = 0; i < GRID_SIZE; i++) {
            arr.push(CHARS[Math.floor(Math.random() * CHARS.length)]);
        }

        // B. 偶然「なつき」ができてしまったら破壊する（サニタイズ）
        let content = arr.join('');
        while (content.includes(TARGET)) {
            const index = content.indexOf(TARGET);
            // 真ん中の文字を変えて「なつき」を崩す
            arr[index + 1] = CHARS[Math.floor(Math.random() * CHARS.length)];
            content = arr.join('');
        }

        // C. 唯一の「なつき」をランダムな場所に確実に1つだけ埋め込む
        targetIndex = Math.floor(Math.random() * (GRID_SIZE - TARGET.length));
        for (let i = 0; i < TARGET.length; i++) {
            arr[targetIndex + i] = TARGET[i];
        }

        // D. 念のため再チェック（埋め込んだことで前後と繋がって2つ目ができていないか）
        // 極めて稀なケースだが「絶対」という指示に基づきチェックを徹底
        content = arr.join('');
        const occurrences = (content.match(/なつき/g) || []).length;
        if (occurrences > 1) {
            // 万が一2つ以上あれば、最初から生成し直す（再帰）
            return generateUniqueData();
        }

        return arr;
    }

    /**
     * 正誤判定
     */
    function checkAnswer(index) {
        if (isFinished) return;

        // クリックされたのが「なつき」のいずれかの文字か
        if (index >= targetIndex && index < targetIndex + TARGET.length) {
            isFinished = true;
            clearInterval(timerId);
            
            // 3文字すべてハイライト
            for (let i = 0; i < TARGET.length; i++) {
                document.querySelector(`[data-index="${targetIndex + i}"]`).classList.add('found');
            }
            
            setTimeout(() => {
                alert(`正解です！\nタイム: ${document.getElementById('timer').innerText}秒`);
            }, 200);
        }
    }

    /**
     * ギブアップ
     */
    function revealAnswer() {
        if (isFinished) return;
        for (let i = 0; i < TARGET.length; i++) {
            document.querySelector(`[data-index="${targetIndex + i}"]`).classList.add('hint');
        }
        isFinished = true;
        clearInterval(timerId);
    }

    /**
     * タイマー更新
     */
    function updateTimer() {
        const diff = (Date.now() - startTime) / 1000;
        document.getElementById('timer').innerText = diff.toFixed(1);
    }

    // 初回起動
    window.onload = startGame;
</script>

</body>
</html>